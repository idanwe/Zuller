<!DOCTYPE html>
<html lang="he" ng-app="Zuller">
<head>
  <title>Zuller</title>
  <!-- <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/css/bootstrap-combined.min.css" rel="stylesheet"> -->
  <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" type="text/css" href="css/app.css">
</head>

<body>

  <div id="wrapper">
    <div id="bla"></div>
    <div id="carousel">
      <ul>
        <li class="page pane1" ng-controller="PartiesCtrl" ng-include="templateUrl">
        </li>
        <li class="page pane2" ng-controller="MainCtrl" ng-include="templateUrl">
        </li>
        <li class="page pane3" ng-controller="ZullerMyNightCtrl" ng-include="templateUrl">
        </li>
      </ul>
    </div>
  </div>


  <!-- jQuery is just for the demo! Hammer.js works without jQuery :-) -->
   <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>

  <script src="lib/angular/angular.1.1.5.js"></script>
  <script src="lib/angular-mobile.js"></script>
  <script src="lib/modernizr.js"></script>
  <script src="lib/jquery.hammer.js"></script>
  <script src="lib/hammer-carousel.js"></script>
  <script src="lib/ga.js"></script>
  <script src="js/app.js"></script>
  <script src="js/services.js"></script>
  <script src="js/controllers.js"></script>
  <script src="js/filters.js"></script>
  <script src="js/directives.js"></script>

  <script>
    var element = "#carousel";
    var container = $(">ul", element);
    var panes = $(">ul>li", element);

    var pane_width = $(element).width();
    var pane_count = panes.length;

    var current_pane = 0;

    showPane = function( index ) {
      // between the bounds
      index = Math.max(0, Math.min(index, pane_count - 1));
      current_pane = index;

      var offset = - ((100 / pane_count) * current_pane);
      setContainerOffset(offset, true);
    };

    next = function() {
      return showPane(current_pane + 1, true);
    };
    prev = function() {
      return showPane(current_pane - 1, true);
    };

    function setContainerOffset(percent, animate) {
      container = $("#bla")
      percent = percent / 3;
      container.removeClass("animate");

      if(animate) {
        container.addClass("animate");
      }

      if(Modernizr.csstransforms3d) {
        console.log("transform3d");
        container.css("transform", "translate3d("+ percent +"%,0,0) scale3d(1,1,1)");
      }
      else if(Modernizr.csstransforms) {
        console.log("transforms");
        container.css("transform", "translate("+ percent +"%,0)");
      }
      else {
        console.log("else");
        var px = ((pane_width * pane_count) / 100) * percent;
        container.css("left", px + "px");
      }
    }

    handleBackgroundHammer = function(ev) {
      switch(ev.type) {

        case 'dragright':
        case 'dragleft':
          // stick to the finger

          var pane_offset = -(100/pane_count)*current_pane;
          var drag_offset = ((100/pane_width)*ev.gesture.deltaX) / pane_count;

          // slow down at the first and last pane
          if((current_pane == 0 && ev.gesture.direction == Hammer.DIRECTION_RIGHT) ||
              (current_pane == pane_count-1 && ev.gesture.direction == Hammer.DIRECTION_LEFT)) {
              drag_offset *= .4;
          }

          setContainerOffset(drag_offset + pane_offset);
          break;

        case 'swipeleft':
          next();
          ev.gesture.stopDetect();
          break;

        case 'swiperight':
          prev();
          ev.gesture.stopDetect();
          break;

        case 'release':
          console.log("release")
          // more then 50% moved, navigate
          if(Math.abs(ev.gesture.deltaX) > pane_width/2) {
            // console.log("current_pane")
            if(ev.gesture.direction == 'right') {
              prev();
            } else {
              next();
            }
          }
          else {
            console.log("current_pane")
            self.showPane(current_pane, true);
          }
          break;
      }
    }


    var carousel = new Carousel("#carousel");
    carousel.init();



    $(document).ready(function(){
      $("#carousel").hammer().on("release dragleft dragright swipeleft swiperight", handleBackgroundHammer);
    });
  </script>

</body>
</html>
